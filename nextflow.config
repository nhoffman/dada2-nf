// these values supersede params in the profile and are themselves
// superseded by contents of -params-file
params {
    min_reads = 1
    trim_left = 15
    f_trunc = 280
    r_trunc = 250
    self_consist = 'TRUE'
    container = 'quay.io/nhoffman/dada2-nf:v1.12-9-g39fa45b'
}

profiles {

    standard {
        workDir = "work"
        resume = true  // null for no resume
        docker {
            enabled = true
        }
        params {
            output = 'output'
        }
        process {
            container = params.container
            executor = 'local'
        }
    }

    uw_batch {
        workDir = 's3://uwlm-personal/ngh2/dada2-nf/work'
        // executor.disableRemoteBinDir = true
        process {
            scratch = "/docker_scratch"
            queue = 'ngs-queue'
            executor = 'awsbatch'
            container = params.container

            // allocate resources according to labels; see
            // https://www.nextflow.io/docs/latest/config.html#scope-process
            // https://www.nextflow.io/docs/latest/process.html#label
            withLabel: med_cpu_mem {
                cpus = 8
                memory = { 8.GB * task.attempt }
                errorStrategy = 'retry'
                maxRetries = 3
            }
        }
        aws {
            region = 'us-west-2'
            batch {
                volumes = '/docker_scratch'
                cliPath = '/home/ec2-user/miniconda/bin/aws'
            }
        }
    }

    hutch_batch {
        workDir = "s3://fh-pi-fredricks-d/lab/nhoffman/dada2-nf/work"
        resume = true
        params {
            output = 'output'
        }
        process {
            executor = 'awsbatch'
            container = params.container
            scratch = '/docker_scratch'
            queue = 'optimal' // optimal, highmem, spot-test, mixed (not working?)

            // allocate resources according to labels; see
            // https://www.nextflow.io/docs/latest/config.html#scope-process
            // https://www.nextflow.io/docs/latest/process.html#label
            withLabel: med_cpu_mem {
                cpus = 8
                memory = { 8.GB * task.attempt }
                errorStrategy = 'retry'
                maxRetries = 3
            }
        }
        aws {
            batch {
                // https://github.com/nextflow-io/nextflow/issues/849
                cliPath = '/home/ec2-user/miniconda/bin/aws'
                volumes = '/docker_scratch'
                jobRole = 'arn:aws:iam::064561331775:role/fh-pi-fredricks-d-batchtask'
            }
        }
    }
}
